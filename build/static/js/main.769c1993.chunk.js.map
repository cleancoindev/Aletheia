{"version":3,"sources":["components/Intro.js","components/Analyze.js","App.js","serviceWorker.js","index.js"],"names":["Intro","db","useState","poemName","setPoemName","versions","setVersions","poems","docs","doc","includes","poem","push","docOptions","i","length","j","doc2","key","name","value","translator","id","className","htmlFor","onChange","e","target","map","href","src","alt","COMMON_WORDS","Set","heatHSL","val","DocAnalyze","showHeader","docSent","sections","sec","gcp","sent_score","sent_mag","reduce","acc","curr","speakers","quotes","corenlp","secs","quotesBySpeaker","quote","find","text","startIdx","sentences","findIndex","s","substring","endIdx","sumSent","sent","speaker","canonicalSpeaker","quoteData","sort","a","b","extractQuotes","words","fullText","flat","join","replace","split","counts","forEach","keys","Object","idx","word","has","toLowerCase","count","topWords","style","width","paddingLeft","book","fontSize","word_cnt","color","toFixed","SpeakerBtn","WordBtn","RowAnalyze","docA","docB","secA","secB","TextBlock","sentiment","entities","ent","salience","regex","RegExp","Math","abs","textrazor","borderLeftColor","dangerouslySetInnerHTML","__html","visable","setVisable","display","padding","class","backgroundColor","onClick","min","w","max","Analyze","selected","rowCnt","section_cnt","justifyContent","alignItems","Array","textAlign","App","props","state","fetch","then","res","json","setState","this","search","window","location","docNames","React","Component","Boolean","hostname","match","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.769c1993.chunk.js","sourcesContent":["import React, { useState } from 'react';\r\n\r\nfunction Intro({ db }) {\r\n  let [poemName, setPoemName] = useState('none');\r\n  let [versions, setVersions] = useState([]);\r\n  let poems = [];\r\n  let docs = [];\r\n  if (db) {\r\n    for (let doc of db) {\r\n      if (!poems.includes(doc.poem)) {\r\n        poems.push(doc.poem);\r\n      }\r\n      if (doc.poem == poemName) {\r\n        docs.push(doc);\r\n      }\r\n    }\r\n  }\r\n  let docOptions = [];\r\n  for (let i = 0; i < docs.length; i++) {\r\n    for (let j = i + 1; j < docs.length; j++) {\r\n      let doc = docs[i];\r\n      let doc2 = docs[j];\r\n      docOptions.push(<option key={doc.name + doc2.name} value={doc.name + '-vs-' + doc2.name}>{doc.translator} vs {doc2.translator}</option>);\r\n    }\r\n  }\r\n  return (\r\n    <div id=\"wrapper\" className=\"divided\">\r\n      <section className=\"banner style1 orient-left content-align-left image-position-right fullscreen onload-image-fade-in onload-content-fade-right\">\r\n        <div className=\"content\">\r\n          <h1>Aletheia</h1>\r\n          <p className=\"major\">A high level translation comparison tool.</p>\r\n          {!db && <p className=\"major\"><i>Loading Archive...</i></p>}\r\n          {db &&\r\n            <div className=\"fields\">\r\n              <div className=\"field\">\r\n                <label htmlFor=\"poem\">Poem</label>\r\n                <select name=\"poem\" id=\"poem\" onChange={(e) => setPoemName(e.target.value)}>\r\n                  <option value=\"\">- Poem -</option>\r\n                  {poems.map(name => <option key={name} value={name}>{name}</option>)}\r\n                </select>\r\n              </div>\r\n              <br />\r\n              <div className=\"field\">\r\n                <label htmlFor=\"versions\">Versions</label>\r\n                <select name=\"versions\" id=\"versions\" onChange={(e) => {\r\n                  setVersions(e.target.value)\r\n                }}>\r\n                  <option value=\"\">- A vs. B -</option>\r\n                  {docOptions}\r\n                </select>\r\n              </div>\r\n            </div>}\r\n          <br />\r\n          {db && <ul className=\"actions stacked\">\r\n            <li><a href={`/?${versions}`} className=\"button big wide smooth-scroll-middle\">Analyze</a></li>\r\n          </ul>}\r\n        </div>\r\n        <div className=\"image\">\r\n          <img src=\"images/banner.jpg\" alt=\"\" />\r\n        </div>\r\n      </section>\r\n    </div>\r\n  );\r\n\r\n}\r\n\r\nexport default Intro;\r\n","import React, { useState } from 'react';\r\n\r\n\r\nconst COMMON_WORDS = new Set([\r\n  'the', 'and', 'of', 'to', 'with', 'her', 'in', 'a', 'his', 'i', 'she', 'my', 'from', \r\n  'on', 'you', 'that', 'he', 'your', 'for', 'is', '-', 'as', 'by', 'not', 'all', 'me', \r\n  'this', 'have', 'or', 'was', 'it', 'their', 'will', 'him', 'now', 'at', 'be', 'when', \r\n  'do', 'what', 'while', 'but', 'has', 'shall', 'were', 'are', 'through', '', 'there', \r\n  'one', 'out', 'these', 'so', 'had', 'nor', 'down', 'such', 'into', 'our', 'away', \r\n  'if', 'who', 'they', 'up', 'first', 'own', 'thus', 'spoke', 'whom', 'them', 'its', \r\n  'once', 'over', 'then', 'went', 'upon', 'said', 'may', 'we', 'which'\r\n]);  \r\n  \r\n\r\nfunction heatHSL(val) {\r\n  return `hsl(${55 + val}, 75%, 75%)`\r\n}\r\n\r\nfunction extractQuotes(doc) {\r\n  let quotes = doc.corenlp.quotes;\r\n  let secs = doc.sections;\r\n  let quotesBySpeaker = {};\r\n  for(let quote of quotes) {\r\n    let sec = secs.find(sec => sec.text.includes(quote.text));\r\n    if(!sec) {\r\n      continue;\r\n    }\r\n    let startIdx = sec.gcp.sentences\r\n      .findIndex(s => s.text.includes(quote.text.substring(0, 10)));\r\n    let endIdx = sec.gcp.sentences\r\n      .findIndex(s => s.text.includes(quote.text.substring(quote.text.length - 10)));\r\n    if(startIdx == -1 || endIdx == -1) {\r\n      continue;\r\n    }\r\n    let sumSent = 0;\r\n    for(let i = startIdx; i <= endIdx; i++) {\r\n      sumSent += sec.gcp.sentences[i].sent_score * sec.gcp.sentences[i].sent_mag;\r\n    }\r\n    quote.sent = sumSent / (endIdx - startIdx + 1);\r\n    if(!(quote.speaker in quotesBySpeaker)) {\r\n      quotesBySpeaker[quote.speaker] = [];\r\n    }\r\n    if(!(quote.canonicalSpeaker in quotesBySpeaker)) {\r\n      quotesBySpeaker[quote.canonicalSpeaker] = [];\r\n    }\r\n    quotesBySpeaker[quote.speaker].push(quote);\r\n    quotesBySpeaker[quote.canonicalSpeaker].push(quote);\r\n  }\r\n  let speakers = [];\r\n  for(let speaker in quotesBySpeaker) {\r\n    let quoteData = {\r\n      name: speaker,\r\n      quotes: quotesBySpeaker[speaker]\r\n    };\r\n    quoteData.sent = quoteData.quotes\r\n      .map(quote => quote.sent)\r\n      .reduce((acc, curr) => acc + curr * (1 / quoteData.quotes.length), 0);\r\n    speakers.push(quoteData);\r\n  }\r\n  speakers.sort((a, b) => a.sent - b.sent);\r\n  return speakers;\r\n}\r\n\r\nfunction topWords(doc) {\r\n  let fullText = doc.sections.map(sec => sec.text).flat().join(' ').replace(/[\\.!\"'?,]/g, '').split(' ');\r\n  let counts = {};\r\n  fullText.forEach(val => counts[val] = (counts[val] || 0) + 1);\r\n  let keys = Object.keys(counts);\r\n  keys.sort((a, b) => counts[b] - counts[a]);\r\n  let words = [];\r\n  for(let idx = 0; words.length < 10 && idx < keys.length; idx++) {\r\n    let word = keys[idx];\r\n    if(COMMON_WORDS.has(word.toLowerCase())) {\r\n      continue;\r\n    }\r\n    words.push({word: word, count: counts[word]});\r\n  }\r\n  return words;\r\n}\r\n\r\nfunction Analyze({ selected }) {\r\n  let rowCnt = Math.min(selected[0].section_cnt, selected[1].section_cnt);\r\n  return (\r\n    <div>\r\n      <div style={{ display: 'flex', justifyContent: 'space-around', alignItems: 'baseline'}}>\r\n        <DocAnalyze doc={selected[0]} showHeader={true} />\r\n        <DocAnalyze doc={selected[1]} />\r\n      </div>\r\n      {[...Array(rowCnt).keys()].map(idx =>\r\n        <div style={{ display: 'flex', justifyContent: 'space-around', textAlign: 'left' }}>\r\n          <RowAnalyze key={idx} docs={selected} idx={idx} />\r\n        </div>)}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction DocAnalyze({ doc, showHeader }) {\r\n  let sumSent = doc.sections\r\n    .map(sec => sec.gcp.sent_score * sec.gcp.sent_mag)\r\n    .reduce((acc, curr) => acc + curr, 0);\r\n  let docSent = sumSent / doc.sections.length;\r\n  let speakers = extractQuotes(doc);\r\n  let words = topWords(doc);\r\n  return (\r\n    <section className=\"banner style1\" style={{ width: '45%' }}>\r\n      <div className=\"content\" style={{ paddingLeft: '0' }}>\r\n        {showHeader ? <h1>{doc.poem} / {doc.book}</h1> : <h1>&nbsp;</h1>}\r\n        <h1 style={{ fontSize: '2em' }}>{doc.translator}</h1>\r\n        <span className=\"major\">Words: <b>{doc.word_cnt}</b></span>\r\n        <br />\r\n        <span className=\"major\">Sentiment: <b style={{color: heatHSL(docSent * 100)}}>{docSent.toFixed(2)}</b></span>\r\n        <br /><br />\r\n        {speakers.map(speaker => <SpeakerBtn speaker={speaker}/>)}\r\n        <br /><br />\r\n        {words.map(word => <WordBtn word={word} words={words} />)}\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n\r\nfunction RowAnalyze({ idx, docs, key }) {\r\n  let [docA, docB] = docs;\r\n  let [secA, secB] = [docA.sections[idx], docB.sections[idx]];\r\n  return [\r\n    <TextBlock key={'a' + key} sec={secA} doc={docA} />,\r\n    <TextBlock key={'b' + key} sec={secB} doc={docB} />\r\n  ];\r\n}\r\n\r\nfunction TextBlock({ sec, key, doc }) {\r\n  let sentiment = sec.gcp.sent_score * sec.gcp.sent_mag * 60;\r\n  let text = sec.text;\r\n  for(let ent of sec.gcp.entities) {\r\n    if(ent.salience < 0.01) {\r\n      continue;\r\n    }\r\n    let sent = ent.sent_score * ent.sent_mag;\r\n    let regex = new RegExp(`\\\\b${ent.name}\\\\b`);\r\n    if(Math.abs(sent) > 0.5) {\r\n      text = text.replace(regex, `<b style=\"color: ${heatHSL(sent * 60)}\">${ent.name}</b>`);\r\n    } else {\r\n      text = text.replace(regex, `<b>${ent.name}</b>`);\r\n    }\r\n  }\r\n  for(let ent of sec.textrazor) {\r\n    let regex = new RegExp(`\\\\b${ent.text}\\\\b`);\r\n    text = text.replace(regex, `<b>${ent.text}</b>`);\r\n  }\r\n  return (\r\n    <section key={key} className=\"style1\" style={{ width: '45%' }}>\r\n      <div className=\"content\">\r\n        <blockquote style={{ borderLeftColor: heatHSL(sentiment) }} dangerouslySetInnerHTML={{__html: text}}/>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n\r\nfunction SpeakerBtn({ speaker }) {\r\n  let [visable, setVisable] = useState(false);\r\n  return (\r\n    <div style={{display: 'inline-block', padding: '1.5px'}}>\r\n      <i class=\"button small\" style={{backgroundColor: heatHSL(speaker.sent * 160)}}\r\n          onClick={() => setVisable(!visable)}>\r\n        {speaker.name} ({speaker.quotes.length})\r\n      </i>\r\n      {visable && speaker.quotes.map((quote, idx) => \r\n        <blockquote key={idx} style={{ borderLeftColor: heatHSL(quote.sent * 60) }}>{quote.text}</blockquote>)}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction WordBtn({ word, words }) {\r\n  let min = Math.min(...words.map(w => w.count));\r\n  let max = Math.max(...words.map(w => w.count));\r\n  return (\r\n    <div style={{display: 'inline-block', padding: '1.5px'}}>\r\n      <i class=\"button small\" style={{backgroundColor: `hsla(180, 75%, 75%, ${(word.count - min) / max})`}}>\r\n        {word.word} ({word.count})\r\n      </i>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Analyze;\r\n","import React from 'react';\nimport Intro from './components/Intro';\nimport Analyze from './components/Analyze';\nimport './App.css';\n\nclass App extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {db: null};\n  }\n\n  componentDidMount() {\n    (async () => {\n      let db = await fetch('/db.json').then(res => res.json());\n      this.setState({db: db});\n    })();\n  }\n\n  render() {\n    let { db } = this.state;\n    let search = window.location.search;\n    let selected = null;\n    if(search && db) {\n      let docNames = search.substring(1).split('-vs-');\n      selected = [\n        db.find(doc => doc.name == docNames[0]),\n        db.find(doc => doc.name == docNames[1])\n      ];\n    }\n    return (\n      <div className=\"App\">\n        {!search && !selected && <Intro db={db} />}\n        {selected && <Analyze selected={selected} />}\n      </div>\n    );\n  }\n\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}